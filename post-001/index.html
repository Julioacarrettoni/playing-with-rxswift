<!DOCTYPE html>
<html>

<head>
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <title>
        
    </title>

    

<link id="darkly" class="stylesheet" rel="stylesheet"
    href="https:&#x2F;&#x2F;julioacarrettoni.github.io&#x2F;playing-with-rxswift&#x2F;darkly.css" />


    <!-- This script must follow css -->
    
    <script type="text/javascript" src="https:&#x2F;&#x2F;julioacarrettoni.github.io&#x2F;playing-with-rxswift&#x2F;js&#x2F;zulma_switchcss.js"></script>
    

    

    
    <script defer type="text/javascript" src="https:&#x2F;&#x2F;julioacarrettoni.github.io&#x2F;playing-with-rxswift&#x2F;elasticlunr.min.js"></script>
    <script defer type="text/javascript" src="https:&#x2F;&#x2F;julioacarrettoni.github.io&#x2F;playing-with-rxswift&#x2F;search_index.en.js"></script>
    

    
    

    <noscript>
        <style>
            .navbar-menu {
                display: block;
            }

            .js-only {
                display: none;
            }
        </style>
    </noscript>
    
</head>

<body>
    
    
<!-- START NAV -->


    

<header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-brand">
                
                <a class="navbar-item" href="/playing-with-rxswift">
                    
                    <span>Playing with RxSwift</span>
                    
                </a>
                
                <span class="navbar-burger burger" data-target="navbarMenu">
                    <span></span>
                    <span></span>
                    <span></span>
                </span>
            </div>
            <div id="navbarMenu" class="navbar-menu">
                <div class="navbar-end">
                    

                    
                    <div class="navbar-item search-container js-only">
                        <input class="input" id="search" type="search" placeholder="Search">

                        <div class="search-results box">
                            <div class="search-results__items"></div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </nav>
</header>


    

<!-- END NAV -->
<main>
    <section class="container">
        <div class="columns is-desktop">
            <div class="column is-10-desktop is-offset-1-desktop">
                <article itemscope itemtype="http://schema.org/BlogPosting">
                    <div class="card article">
                        <div class="card-content">
                            
<header>
    <div class="has-text-centered">
        <a href="https://julioacarrettoni.github.io/playing-with-rxswift/post-001/">
            <p class="title article-title">1. First Single endpoint
            </p>
        </a>
        <div class="tags has-addons level-item">
            <span class="tag is-rounded">2020-03-15</span>
                       
            <span class="tag is-rounded">
<svg class="i-clock" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round"
    stroke-linejoin="round" stroke-width="6.25%">
    <circle cx="16" cy="16" r="14" />
    <path d="M16 8 L16 16 20 20" />
</svg>
<span>&nbsp;22 minute read</span>
</span>
        </div>
    </div>
</header>

                            <div itemprop="articleBody" class="content article-body">
                                <p>Learn the background story, explore the sample app, and convert our first closure-driven endpoint to the Rx world by using a <a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/Traits.md#single">Single</a>.</p>
<p>Feel free to use this link to skip all the paraphernalia of the post and dive directly into the code.<br />
<strong><a href="https://julioacarrettoni.github.io/playing-with-rxswift/post-001/#skip_intro">Skip intro</a></strong></p>
<span id="continue-reading"></span><h1 id="background-story">Background story</h1>
<p>The key to a good product is a good story, it is true for presentations<sup><a href="https://julioacarrettoni.github.io/playing-with-rxswift/post-001/#1">1</a></sup>, commercials<sup><a href="https://julioacarrettoni.github.io/playing-with-rxswift/post-001/#2">2</a></sup> and even apps<sup><a href="https://julioacarrettoni.github.io/playing-with-rxswift/post-001/#3">3</a></sup>, so here is the one I came up with for this blog:</p>
<p>You recently joined a small mobile team in a medium-sized company, this company is big enough to have processes and a little bureaucracy but not big enough to already have a mobile department. Their technology is a little old, and most engineers are busy maintaining the core products.<br />
You will have to work with what you are given, and it is rarely going to be ideal, well not ideal for you, but ideal for me who controls the plot. üòÅ</p>
<p>Anyway, the company is call <em>Thomson Brother's Division</em> or TBD for short<sup><a href="https://julioacarrettoni.github.io/playing-with-rxswift/post-001/#4">4</a></sup>, they do a little of everything including logistics. In recent years they decided it was time to modernize and they plan to launch their fleet control system on the mobile world.</p>
<div align="center"><img src="../tbd_logo.png" alt="Thomson Brother's Division logo created at freelogodesign.org"><br><small>Logo created at <a href="https://www.freelogodesign.org/">Freelogodesign.org</a></small></div>
<p>The CEO wants everything to be modern and shiny, they read somewhere (probably a newsletter) that React Native is the next big thing, they also found that Rx is a react framework available on both Android and iOS, so the app has to be rebuilt using RxSwift (Yes I know ReactNative and Rx are different things, but the CEO doesn't so ü§´).</p>
<div align="center"><img src="../001_react_logo.png" alt="ReactNative logo"><img src="../rxswift_logo.png" alt="RxSwift Logo"></div>
<p>That's where you enter. You were hired to build those mobile apps using RxSwift and SwiftUI, but although you know some RxSwift, you don't consider yourself an expert (otherwise, you wouldn't be wasting your time here).
Someone already wrote a proof of concept app that was a success across the company directors and to &quot;save time&quot; you <em>have to</em> build on top of that instead of starting from scratch like any sane human been would do<sup><a href="https://julioacarrettoni.github.io/playing-with-rxswift/post-001/#5">5</a></sup>.<br />
BTW the POC also uses a proprietary network library (probably written in Objective-C and built on top of <a href="https://allseeing-i.com/ASIHTTPRequest/">ASIHTTPRequest</a> so there is no way to modify it or use any cool network-level feature<sup><a href="https://julioacarrettoni.github.io/playing-with-rxswift/post-001/#5">5</a></sup>.</p>
<h3 id="the-app">The app</h3>
<p>The first app we need to build is the &quot;Overview&quot; app. An app where managers can see the current status of their distribution center.<br />
A distribution center has couriers and vehicles. Clients make requests, and packages are delivered from the distribution center to the client address, depending on the distance the courier might go on foot or in a vehicle.
The App has to show:</p>
<ol>
<li>
<p>A Map that shows the locations and status of:</p>
<ul>
<li>Couriers</li>
<li>Vehicles</li>
<li>Clients (active)</li>
<li>The warehouse location</li>
</ul>
</li>
<li>
<p>A tabbed section that shows a list of the following elements and when selected display more details about them:</p>
<ul>
<li>Couriers</li>
<li>Packages</li>
<li>Vehicles</li>
</ul>
</li>
</ol>
<p>The POC only covers the map, we need to build the rest. In this post we will solely focus on the <strong>Map</strong> part.</p>
<h3 id="the-server">The Server</h3>
<p>Sadly as this company has been running for a long time, most of the core technology is old. The server is built on some ancient and obsolete technology, something like Java‚Ä¶ just teasing, it's running on COBOL and communicates back using CORBA and SOAP.<sup><a href="https://julioacarrettoni.github.io/playing-with-rxswift/post-001/#5">5</a></sup>.</p>
<div align="center"><img src="../001_abacus.jpg" alt="The ALU unit on the server"></div>
<p>Luckily the guy who wrote the POC app is a backend engineer and created a ruby middleware that translates to JSON. We don't care what the JSON looks like, parsing server responses is not something we will cover on this blog in detail. We will forget about it and rely on the <a href="/post-000.md#a-different-sample-app">FakeService framework</a> to abstract from all that noise, anyway, all this background story is to say that the server engineers are busy, and you have to work with whatever endpoints you are given and get creative with them.</p>
<table><thead><tr><th></th></tr></thead><tbody>
</tbody></table>
<h1 id="skip_intro">Work</h1>
<h3 id="goal">Goal</h3>
<p>Our goal is to add the RxSwift dependency into the PoC project and then rewrite the only endpoint we have to be more &quot;Reactive&quot;.</p>
<h3 id="code">Code</h3>
<p>You will need Xcode 11.4 or newer.</p>
<p>You can download the sample apps from <a href="https://github.com/Julioacarrettoni/playing-with-rxswift/tree/master/001">here</a>, you should start working on the <em>before</em> folder, in the end, it should look like the <em>after</em> folder.</p>
<p>Open the <code>RxPlaying.xcodeproj</code> project. You will notice it has two targets </p>
<div align="center"><img src="../001_structure.png" alt="Project folders and targets"></div>
For simplicity, I won't cover Unit testing on this post, and I removed the unit tests for the FakeService framework, but believe me, it has Unit tests, a lot of them üò¨ (no, really, it does!)
<p>You can go ahead and run the RxPlaying target if you like, you can choose to run it on iOS or macOS (if you are running Catalina) either will do although it will look better on iOS, every time you run the application the same sequence will play. The map starts centered on the fictitious warehouse currently on the corner of Ellis and Stockton in San Francisco, then a client requests a package near Pier 9, and Simon gets dispatched there on a car. üöò<br />
The same JSON files (available inside the FakeService framework) are played over and over again, there is enough data for a little over 1 hour of activity for a total of 4 couriers, 2 vehicles and 17 packages being delivered to 13 different locations (some destinations are repeated).</p>
<div align="center"><img src="../001_macos.png" alt="MacOS sample app"><img src="../001_ios.png" alt="iOS Sample App"></div>
<p>If you check out the views inside the RxPlaying target there are 2, <a href="https://github.com/Julioacarrettoni/playing-with-rxswift/blob/master/001/Before/RxPlaying/Views/ContentView.swift#L4">ContentView</a> and <a href="https://github.com/Julioacarrettoni/playing-with-rxswift/blob/master/001/Before/RxPlaying/Views/MapView.swift#L5">MapView</a>, we will be ignoring the <code>MapView</code> for now, all it has is code to render the annotations on the map, animate them and some boilerplate to communicate between UIKit and SwiftUI.</p>
<p><code>ContentView</code> on the other hand is quite simple:</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">struct </span><span style="color:#ebcb8b;">ContentView</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">View</span><span style="color:#c0c5ce;"> {
    </span><span style="color:#b48ead;">@State var </span><span style="color:#bf616a;">globalState</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">GlobalState</span><span style="color:#c0c5ce;">? = </span><span style="color:#d08770;">nil
    
    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">body</span><span style="color:#c0c5ce;">: some </span><span style="color:#ebcb8b;">View</span><span style="color:#c0c5ce;"> {
        </span><span style="color:#ebcb8b;">MapView</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">globalState</span><span style="color:#c0c5ce;">: </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.globalState)
            .</span><span style="color:#d08770;">edgesIgnoringSafeArea</span><span style="color:#c0c5ce;">(.</span><span style="color:#d08770;">all</span><span style="color:#c0c5ce;">)
            .</span><span style="color:#d08770;">onAppear</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">perform</span><span style="color:#c0c5ce;">: </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.refreshData)
    }
    
    </span><span style="color:#b48ead;">private func </span><span style="color:#bf616a;">refreshData</span><span style="color:#c0c5ce;">() {
        </span><span style="color:#ebcb8b;">Service</span><span style="color:#c0c5ce;">.getSystemState() { globalState </span><span style="color:#b48ead;">in
            self</span><span style="color:#c0c5ce;">.globalState = globalState
            </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.refreshData()
        }
    }
}
</span></pre>
<p>As soon as <code>MapView</code> renders, the app calls <code>Service.getSystemState</code>, our only endpoint available for now, on the completion block the same method is called again, and again and again and again<sup><a href="https://julioacarrettoni.github.io/playing-with-rxswift/post-001/#5">5</a></sup>. &quot;<em>If it is stupid but it works, it is still stupid.</em>&quot;.<br />
This is what we want to improve with a little Rx, let's get started.</p>
<h3 id="adding-the-dependency">Adding the dependency</h3>
<p>We will be adding RxSwift as a Swift Package dependency, (you can read why on the <a href="/post-000.md#technology">previous post</a>), you can find some details on the RxSwift repository readme.md file (<a href="https://github.com/ReactiveX/RxSwift#swift-package-manager">here</a>) but with the recent versions of Xcode it has gotten quite simple to do.<br />
Go to <code>Files</code>‚Üí<code>Swift Packages</code>‚Üí<code>Add Package Dependency‚Ä¶</code></p>
<div align="center"><img src="../001_package_manager.png" alt="Xcode File menu showing add package"></div>
<p>On the top of the page enter the URL to the RxSwift repo <a href="https://github.com/ReactiveX/RxSwift">https://github.com/ReactiveX/RxSwift</a> and hit <code>Next</code>.</p>
<div align="center"><img src="../001_package_manager_1.png" alt="Step 1, enter repository URL"></div>
<p>On the next screen enter that we want to be using &quot;Up to next mayor&quot; and the version is <code>5.1.0</code> </p>
<div align="center"><img src="../001_package_manager_2.png" alt="Step 2, select version"></div>
<p>Now you have to select which of all the available frameworks we want, for now we will just use RxSwift.</p>
<div align="center"><img src="../001_package_manager_3.png" alt="Step 3, select frameworks"></div>
<p>And finally we are left on the <code>Swift Packages</code> tab for the project configuration, so as you can guess RxSwift is now available for all our targets.</p>
<div align="center"><img src="../001_package_manager_4.png" alt="Step 4, project view showing all swift packages dependencies"></div>
<p>I'm not going to compare tools or advocate in favor of some of the others as this is not the point of the blog‚Ä¶ but‚Ä¶<br />
<strong>COME ON</strong> that was super easy and straight forward!!! üòÑ</p>
<h3 id="using-rxswift">Using RxSwift</h3>
<p>Now is time to use RxSwift, let's modify the existing method that wraps around FakeService framework, it's a struct with a single static method in <code>RxPlaying/Services/Service.swift</code></p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">import </span><span style="color:#ebcb8b;">FakeService
</span><span style="color:#b48ead;">import </span><span style="color:#ebcb8b;">Foundation

</span><span style="color:#b48ead;">struct </span><span style="color:#ebcb8b;">Service</span><span style="color:#c0c5ce;"> {
    </span><span style="color:#b48ead;">static func </span><span style="color:#bf616a;">getSystemState</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">completion</span><span style="color:#c0c5ce;">: </span><span style="color:#b48ead;">@escaping</span><span style="color:#c0c5ce;"> (</span><span style="color:#ebcb8b;">GlobalState</span><span style="color:#c0c5ce;">?) -&gt; () ) {
        </span><span style="color:#ebcb8b;">FakeServices</span><span style="color:#c0c5ce;">.shared.getSystemState(</span><span style="color:#bf616a;">completion</span><span style="color:#c0c5ce;">: completion)
    }
}
</span></pre>
<p>First, let's import RxSwift on top</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">import </span><span style="color:#ebcb8b;">FakeService
</span><span style="color:#b48ead;">import </span><span style="color:#ebcb8b;">Foundation
</span><span style="color:#b48ead;">import </span><span style="color:#ebcb8b;">RxSwift
</span></pre>
<p>For now, let's add a new method instead of modifying the existing one, so the rest of the app continues compiling.</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">static func </span><span style="color:#bf616a;">getSystemState</span><span style="color:#c0c5ce;">() -&gt; ???
</span></pre>
<p>Now, methods that take no arguments and return nothing don't seem too useful, or they are full of those nasty side effects‚Ä¶ , anyway, we need to return <em>something</em>, and <code>void</code> doesn't cut it today, (maybe later, like in 2-3 more posts).<br />
What do we know? We know we are going to call an endpoint once and, thus, only get a single response once. It doesn't get easier than this, we need to return a <a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/Traits.md#single">Single</a>.</p>
<p>You reader have two options, you can:</p>
<ol>
<li>Skip the following explanation by clicking üëâ<a href="https://julioacarrettoni.github.io/playing-with-rxswift/post-001/#create_single">here</a>üëà</li>
<li>Continue reading if you want to know a little more about <a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/Traits.md#single">Single</a>. ü§ì</li>
</ol>
<p>The documentation on the github repo for RxSwift (<a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation">link</a>) is quite good ‚ù§Ô∏è, I recommend starting there anytime you have a question, at the very least we will able to find some new words that can help you google.<br />
Now according to the docs, this is the way to create a <a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/Traits.md#single">Single</a>:</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">func </span><span style="color:#bf616a;">getRepo</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">_ </span><span style="color:#bf616a;">repo</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">String</span><span style="color:#c0c5ce;">) -&gt; </span><span style="color:#ebcb8b;">Single</span><span style="color:#c0c5ce;">&lt;[</span><span style="color:#ebcb8b;">String</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">Any</span><span style="color:#c0c5ce;">]&gt; {
    </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Single</span><span style="color:#c0c5ce;">&lt;[</span><span style="color:#ebcb8b;">String</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">Any</span><span style="color:#c0c5ce;">]&gt;.</span><span style="color:#d08770;">create</span><span style="color:#c0c5ce;"> { single </span><span style="color:#b48ead;">in
        let</span><span style="color:#c0c5ce;"> task = </span><span style="color:#ebcb8b;">URLSession</span><span style="color:#c0c5ce;">.shared.dataTask(</span><span style="color:#bf616a;">with</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">URL</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">string</span><span style="color:#c0c5ce;">: </span><span style="color:#a3be8c;">&quot;https://api.github.com/repos/</span><span style="color:#ab7967;">\(</span><span style="color:#c0c5ce;">repo</span><span style="color:#ab7967;">)</span><span style="color:#a3be8c;">&quot;</span><span style="color:#c0c5ce;">)!) { data, </span><span style="color:#d08770;">_</span><span style="color:#c0c5ce;">, error </span><span style="color:#b48ead;">in
            if let</span><span style="color:#c0c5ce;"> error = error {
                single(.</span><span style="color:#d08770;">error</span><span style="color:#c0c5ce;">(error))
                </span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;">
            }

            </span><span style="color:#b48ead;">guard let</span><span style="color:#c0c5ce;"> data = data,
                  </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> json = </span><span style="color:#b48ead;">try</span><span style="color:#c0c5ce;">? </span><span style="color:#ebcb8b;">JSONSerialization</span><span style="color:#c0c5ce;">.jsonObject(</span><span style="color:#bf616a;">with</span><span style="color:#c0c5ce;">: data, </span><span style="color:#bf616a;">options</span><span style="color:#c0c5ce;">: .</span><span style="color:#d08770;">mutableLeaves</span><span style="color:#c0c5ce;">),
                  </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> result = json </span><span style="color:#b48ead;">as</span><span style="color:#c0c5ce;">? [</span><span style="color:#ebcb8b;">String</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">Any</span><span style="color:#c0c5ce;">] </span><span style="color:#b48ead;">else</span><span style="color:#c0c5ce;"> {
                single(.</span><span style="color:#d08770;">error</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">DataError</span><span style="color:#c0c5ce;">.cantParseJSON))
                </span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;">
            }

            single(.</span><span style="color:#d08770;">success</span><span style="color:#c0c5ce;">(result))
        }

        task.resume()

        </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Disposables</span><span style="color:#c0c5ce;">.create { task.cancel() }
    }
}
</span></pre>
<p>Let's go step for step over this example, first let's remove some noise</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">func </span><span style="color:#bf616a;">getSomething</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">_ </span><span style="color:#bf616a;">someValue</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">U</span><span style="color:#c0c5ce;">) -&gt; </span><span style="color:#ebcb8b;">Single</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">T</span><span style="color:#c0c5ce;">&gt; {
    </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Single</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">T</span><span style="color:#c0c5ce;">&gt;.</span><span style="color:#d08770;">create</span><span style="color:#c0c5ce;"> { single </span><span style="color:#b48ead;">in</span><span style="color:#c0c5ce;">
        someAsyncMethod(someValue) { </span><span style="color:#d08770;">_ </span><span style="color:#b48ead;">in
            </span><span style="color:#65737e;">//We will cover this later
</span><span style="color:#c0c5ce;">        }
        </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Disposables</span><span style="color:#c0c5ce;">.create { </span><span style="color:#65737e;">/* some cleaning */</span><span style="color:#c0c5ce;"> }
    }
}
</span></pre>
<p>First it creates a <a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/Traits.md#single">Single</a> as required by the return type using the create method <code>Single&lt;T&gt;.create</code> that takes a closure as an argument, the nice thing about Rx is that it is open source and we can take a peek at how it works (<a href="https://github.com/ReactiveX/RxSwift/blob/c6c0c540109678b96639c25e9c0ebe4a6d7a69a9/RxSwift/Traits/Single.swift#L37">link</a>) but sometimes it can be a little overwhelming. üò∂ </p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">public static func </span><span style="color:#bf616a;">create</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">subscribe</span><span style="color:#c0c5ce;">: </span><span style="color:#b48ead;">@escaping</span><span style="color:#c0c5ce;"> (</span><span style="color:#b48ead;">@escaping </span><span style="color:#ebcb8b;">SingleObserver</span><span style="color:#c0c5ce;">) -&gt; </span><span style="color:#ebcb8b;">Disposable</span><span style="color:#c0c5ce;">) -&gt; </span><span style="color:#ebcb8b;">Single</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">Element</span><span style="color:#c0c5ce;">&gt;
</span></pre>
<p>What you need to know is that this <code>create</code> method takes a <a href="https://docs.swift.org/swift-book/LanguageGuide/Closures.html#ID546">@escaping</a> closure meaning that whatever it does will be done later (or maybe never).</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">@escaping</span><span style="color:#c0c5ce;"> (</span><span style="color:#b48ead;">@escaping </span><span style="color:#ebcb8b;">SingleObserver</span><span style="color:#c0c5ce;">) -&gt; </span><span style="color:#ebcb8b;">Disposable
</span></pre>
<p>The closure is where we do our async work, the closure gives us another closure called <a href="https://github.com/ReactiveX/RxSwift/blob/70b8a33c5c3f4c3b15ebf10b638d2b15cfafb814/RxSwift/Traits/Single.swift#L27">SingleObserver</a> that we can use to communicate back the result of our async task.<br />
It takes a single value, an enum <a href="https://github.com/ReactiveX/RxSwift/blob/70b8a33c5c3f4c3b15ebf10b638d2b15cfafb814/RxSwift/Traits/Single.swift#L18">SingleEvent&lt;Element&gt;</a> that can only take 2 values, <code>success</code> or <code>error</code>, yes, it is pretty much a <a href="https://developer.apple.com/documentation/swift/result">Result type</a>.</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">public enum </span><span style="color:#ebcb8b;">SingleEvent</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">Element</span><span style="color:#c0c5ce;">&gt; {
    </span><span style="color:#65737e;">/// One and only sequence element is produced.
    </span><span style="color:#b48ead;">case</span><span style="color:#c0c5ce;"> success(</span><span style="color:#ebcb8b;">Element</span><span style="color:#c0c5ce;">)
    
    </span><span style="color:#65737e;">/// Sequence terminated with an error.
    </span><span style="color:#b48ead;">case</span><span style="color:#c0c5ce;"> error(</span><span style="color:#ebcb8b;">Swift</span><span style="color:#c0c5ce;">.</span><span style="color:#ebcb8b;">Error</span><span style="color:#c0c5ce;">)
}
</span></pre>
<p>The closure has to return a <a href="https://github.com/ReactiveX/RxSwift/blob/53cd723d40d05177e790c8c34c36cec7092a6106/RxSwift/Disposable.swift">Disposable</a> (Don't bother with the link there is not much there) The idea with disposables is that the consumer of this methods hold on to them for as long as they are interested in getting values out of the observables, when they are no longer interested they just throw away the disposable. üöÆ<br />
The Disposable takes a closure that gets executed when the disposable &quot;dies&quot; or the observable completes its task; some of them never do as they are &quot;infinite&quot;, but the single isn't.<br />
As you can see in the original example, the disposable calls <code>task.cancel()</code> to perform some cleanup.</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Disposables</span><span style="color:#c0c5ce;">.create { task.cancel() }
</span></pre>
<p><a id='multiple'></a>
You can create as many <a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/Traits.md#single">Singles</a> as you want and nothing will happen, is not until you &quot;use&quot; them that the closure is computed. Also, you can create only one <a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/Traits.md#single">Single</a> and &quot;re-use&quot; it multiple times, every time you &quot;use&quot; it the closure gets rerun.</p>
<p>To &quot;use&quot; a <a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/Traits.md#single">Single</a> or any other <a href="https://github.com/ReactiveX/RxSwift/blob/c6c0c540109678b96639c25e9c0ebe4a6d7a69a9/RxSwift/ObservableType.swift#L10">ObservableType</a> you <a href="https://github.com/ReactiveX/RxSwift/blob/c6c0c540109678b96639c25e9c0ebe4a6d7a69a9/RxSwift/ObservableType.swift#L34">subscribe</a> to it, this returns a <a href="https://github.com/ReactiveX/RxSwift/blob/53cd723d40d05177e790c8c34c36cec7092a6106/RxSwift/Disposable.swift">Disposable</a> that you should hold onto or nothing will happen (and throw away when you no longer care about it), we will worry about this in a bit, let's go back to our example:</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">func </span><span style="color:#bf616a;">getSomething</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">_ </span><span style="color:#bf616a;">someValue</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">U</span><span style="color:#c0c5ce;">) -&gt; </span><span style="color:#ebcb8b;">Single</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">T</span><span style="color:#c0c5ce;">&gt; {
    </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Single</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">T</span><span style="color:#c0c5ce;">&gt;.</span><span style="color:#d08770;">create</span><span style="color:#c0c5ce;"> { single </span><span style="color:#b48ead;">in</span><span style="color:#c0c5ce;">
        someAsyncMethod(someValue) { </span><span style="color:#d08770;">_ </span><span style="color:#b48ead;">in
            </span><span style="color:#65737e;">//Is time to talk about this
</span><span style="color:#c0c5ce;">        }
        </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Disposables</span><span style="color:#c0c5ce;">.create { </span><span style="color:#65737e;">/* some cleaning */</span><span style="color:#c0c5ce;"> }
    }
}
</span></pre>
<p>Let's talk now about communicating results back to the <a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/Traits.md#single">Single</a>, let's assume for simplicity that our async method can tell us if a number is prime or whatever, so it returns a <code>Bool</code> but if it fails it returns <code>nil</code> (Yes, this error management is top-notch) and if it works it tells us either <code>true</code> or <code>false</code>, then our example would look like this replacing those <code>U</code> and <code>T</code>:</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">func </span><span style="color:#bf616a;">isPrime</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">_ </span><span style="color:#bf616a;">someValue</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">UInt</span><span style="color:#c0c5ce;">) -&gt; </span><span style="color:#ebcb8b;">Single</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">Bool</span><span style="color:#c0c5ce;">&gt; {
    </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Single</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">Bool</span><span style="color:#c0c5ce;">&gt;.</span><span style="color:#d08770;">create</span><span style="color:#c0c5ce;"> { single </span><span style="color:#b48ead;">in</span><span style="color:#c0c5ce;">
        someAsyncMethod(someValue) { response </span><span style="color:#b48ead;">in
            </span><span style="color:#65737e;">//And now?
</span><span style="color:#c0c5ce;">        }
        </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Disposables</span><span style="color:#c0c5ce;">.create() </span><span style="color:#65737e;">// There is nothing to clean.
</span><span style="color:#c0c5ce;">    }
}
</span></pre>
<p>So the body of that closure could be something like this:<br />
If we have a boolean, we have a successful result and we tell that to the <a href="https://github.com/ReactiveX/RxSwift/blob/70b8a33c5c3f4c3b15ebf10b638d2b15cfafb814/RxSwift/Traits/Single.swift#L27">SingleObserver</a> else it failed and we communicate that back:</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">someAsyncMethod(someValue) { response </span><span style="color:#b48ead;">in
    if let</span><span style="color:#c0c5ce;"> response = response {
        single(.</span><span style="color:#d08770;">success</span><span style="color:#c0c5ce;">(response))
    } </span><span style="color:#b48ead;">else</span><span style="color:#c0c5ce;"> {
        single(.</span><span style="color:#d08770;">error</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">SomeError</span><span style="color:#c0c5ce;">.unknown))
    }
}
</span></pre>
<p>BTW <code>SomeError.unknown</code> is just a random enum I created so I could send it back:</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">enum </span><span style="color:#ebcb8b;">SomeError</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">Error</span><span style="color:#c0c5ce;"> {
    </span><span style="color:#b48ead;">case</span><span style="color:#c0c5ce;"> unknown
}
</span></pre>
<p>Again, this is to keep the examples simple, so should do proper error handling on your codebase, or you know, just return the optional bool and let the consumer of the method deal with it üòú</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">func </span><span style="color:#bf616a;">isPrime</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">_ </span><span style="color:#bf616a;">someValue</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">UInt</span><span style="color:#c0c5ce;">) -&gt; </span><span style="color:#ebcb8b;">Single</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">Bool</span><span style="color:#c0c5ce;">?&gt; {
    </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Single</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">Bool</span><span style="color:#c0c5ce;">?&gt;.create { single </span><span style="color:#b48ead;">in</span><span style="color:#c0c5ce;">
        someAsyncMethod(someValue) { response </span><span style="color:#b48ead;">in</span><span style="color:#c0c5ce;">
            single(.</span><span style="color:#d08770;">success</span><span style="color:#c0c5ce;">(response)) </span><span style="color:#65737e;">// Everything is a success as our standars are low, like code quality.
</span><span style="color:#c0c5ce;">        }
        </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Disposables</span><span style="color:#c0c5ce;">.create() </span><span style="color:#65737e;">// There is nothing to clean.
</span><span style="color:#c0c5ce;">    }
}
</span></pre>
<p>Don't do this, don't be a horrible person, the consumers of your APIs could be writing your performance review next quarter. üò¨<br />
Also, jokes aside, we will be missing some cool functionality from Rx when we don't properly use it, for example, the remarkable <code>retry</code>. We will cover <a href="https://github.com/ReactiveX/RxSwift/blob/6b2a406b928cc7970874dcaed0ab18e7265e41ef/Documentation/GettingStarted.md#error-handling">Error handling</a> gradually across the series alongside unit testing.</p>
<p>Now we have enough information to write our single.</p>
<h3 id="create_single">Let's create our single</h3>
<p>We don't require arguments, and we expect out a <code>GlobalState?</code></p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">static func </span><span style="color:#bf616a;">getSystemState</span><span style="color:#c0c5ce;">() -&gt; </span><span style="color:#ebcb8b;">Single</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">GlobalState</span><span style="color:#c0c5ce;">?&gt;
</span></pre>
<p>We then create the Single whose element is <code>&lt;GlobalState?&gt;</code></p>
<pre style="background-color:#2b303b;">
<span style="color:#ebcb8b;">Single</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">GlobalState</span><span style="color:#c0c5ce;">?&gt;.create { single </span><span style="color:#b48ead;">in
</span></pre>
<p>The &quot;body&quot; or task on our single is calling <code>FakeServices.shared.getSystemState(completion:)</code> and the way we handle errors (not the best way) is to just send back a nil if it fails, so any value is a success for us:</p>
<pre style="background-color:#2b303b;">
<span style="color:#ebcb8b;">FakeServices</span><span style="color:#c0c5ce;">.shared.getSystemState { globalState </span><span style="color:#b48ead;">in</span><span style="color:#c0c5ce;">
    single(.</span><span style="color:#d08770;">success</span><span style="color:#c0c5ce;">(globalState))
}
</span></pre>
<p>There is nothing to clean, so the <code>Disposable</code> is simply</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Disposables</span><span style="color:#c0c5ce;">.create()
</span></pre>
<p>And all together it looks like this:</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">static func </span><span style="color:#bf616a;">getSystemState</span><span style="color:#c0c5ce;">() -&gt; </span><span style="color:#ebcb8b;">Single</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">GlobalState</span><span style="color:#c0c5ce;">?&gt; {
    </span><span style="color:#ebcb8b;">Single</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#ebcb8b;">GlobalState</span><span style="color:#c0c5ce;">?&gt;.create { single </span><span style="color:#b48ead;">in
        </span><span style="color:#ebcb8b;">FakeServices</span><span style="color:#c0c5ce;">.shared.getSystemState { globalState </span><span style="color:#b48ead;">in</span><span style="color:#c0c5ce;">
            single(.</span><span style="color:#d08770;">success</span><span style="color:#c0c5ce;">(globalState))
        }
          
        </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Disposables</span><span style="color:#c0c5ce;">.create()
    }
}
</span></pre>
<p>And we are <strong>done</strong>, we can call it a day, thank you for coming to my TedTalk, this is the end of the blog.</p>
<p>&quot;<em>But, how do we use it?</em>&quot; üßê you might ask. Ok, then maybe we are not done <em>yet</em>.</p>
<h3 id="using-the-single">Using the single</h3>
<p>Let's use it on our <a href="https://github.com/Julioacarrettoni/playing-with-rxswift/blob/master/001/Before/RxPlaying/Views/ContentView.swift#L4">ContentView</a>, first things first, let's buckle those belts (American Airlines joke).</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">import </span><span style="color:#ebcb8b;">RxSwift
</span></pre>
<p>Let's emptu this method</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">private func </span><span style="color:#bf616a;">refreshData</span><span style="color:#c0c5ce;">() {
}
</span></pre>
<p>And use our new Single:</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">private func </span><span style="color:#bf616a;">refreshData</span><span style="color:#c0c5ce;">() {
    </span><span style="color:#ebcb8b;">Service</span><span style="color:#c0c5ce;">.getSystemState()
}
</span></pre>
<p><a id='subscribe_section'></a>
But as I said before, if we don't subscribe, nothing happens (besides that warning about an unused result).<br />
When you try to subscribe, you will see that you have several options:</p>
<div align="center"><img src="../001_subscribe.png" alt="Autocomplete results for subscribe on a Single"></div>
<ul>
<li>The 1st one subscribes and lets the <a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/Traits.md#single">Single</a> run and do its thing but when we don't particularly care about the result.</li>
<li>The 2nd one lets you subscribe on a specific scheduler, this is not about a particular thread or queue, it's bigger than that, you can read more on the excellent ‚ù§Ô∏è<a href="https://github.com/ReactiveX/RxSwift/blob/70b8a33c5c3f4c3b15ebf10b638d2b15cfafb814/Documentation/Schedulers.md">docs</a>‚ù§Ô∏è we will revisit those later (very later) in this blog, for now all we need to know is:</li>
</ul>
<blockquote>
<p>In case it isn't explicitly specified, work will be performed on whichever thread/scheduler elements are generated.</p>
</blockquote>
<ul>
<li>The 3rd gives you one closure with the result of the single as the enum <a href="https://github.com/ReactiveX/RxSwift/blob/70b8a33c5c3f4c3b15ebf10b638d2b15cfafb814/RxSwift/Traits/Single.swift#L18">SingleEvent</a>, so you can <code>switch</code> on it and do what you want all in a single place.</li>
<li>The 4th one gives you 2 closures, one with the value and one with the error, only one of those will be called, but this way, you don't have to <code>switch</code> over the result and can have the reaction to each case separated, or even ignore one.</li>
</ul>
<p>Which one should we use? Well, the 1st one is useless for us <em>right now</em>, 2nd one is too advanced, 3rd one looks nice, but to be honest, we are doing some very lousy error handling so far, and we don't care about handling the error scenario, so the 4th one it is!</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">private func </span><span style="color:#bf616a;">refreshData</span><span style="color:#c0c5ce;">() {
    </span><span style="color:#ebcb8b;">Service</span><span style="color:#c0c5ce;">.getSystemState().subscribe(</span><span style="color:#bf616a;">onSuccess</span><span style="color:#c0c5ce;">: { globalState </span><span style="color:#b48ead;">in
        </span><span style="color:#65737e;">// Something
</span><span style="color:#c0c5ce;">    }) { error </span><span style="color:#b48ead;">in
        </span><span style="color:#65737e;">// Error handling
</span><span style="color:#c0c5ce;">    }
}
</span></pre>
<p>I <strong>said</strong> we don't care about error handling because we are lousy developers.</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">private func </span><span style="color:#bf616a;">refreshData</span><span style="color:#c0c5ce;">() {
    </span><span style="color:#ebcb8b;">Service</span><span style="color:#c0c5ce;">.getSystemState().subscribe(</span><span style="color:#bf616a;">onSuccess</span><span style="color:#c0c5ce;">: { globalState </span><span style="color:#b48ead;">in
        </span><span style="color:#65737e;">// Something
</span><span style="color:#c0c5ce;">    })
}
</span></pre>
<p>Almost there, we have forgotten to grab onto the disposable, if we don't nothing will happen, besides the useful compile warning that is also covered on the ‚ù§Ô∏è<a href="https://github.com/ReactiveX/RxSwift/blob/70b8a33c5c3f4c3b15ebf10b638d2b15cfafb814/Documentation/Warnings.md">docs</a>‚ù§Ô∏è but again it could be a little overwhelming so <strong>TL;DR</strong> version, we just grab all those disposables and thrown them into a bag, we tied the lifetime of the bag to something that makes sense like our <code>View</code>, and we can't forget about it. If we leave this page, the <code>View</code> gets deallocated, that kills the bad and the bag, in turn, kills all the disposables on it, and they do the cleanup on their last breath. ‚ò†Ô∏è</p>
<p>Sometimes you want to have more control; for example, you want to stop any pending request when transitioning to a new screen; in that case, just throw the bag away.<br />
It is also reasonable to have different bags at the same time so you can have more granular control over the lifetime of various disposables by adding them to different bags, this is perfectly fine. However, there might be better ways to handle those cases in more <em>reactive</em> ways (pun intended), we will talk more about this in future posts when we get to some nicely complicated examples üòâ.</p>
<p>Anyways, back on topic. Let's add a local attribute to our view</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> disposeBag = </span><span style="color:#ebcb8b;">DisposeBag</span><span style="color:#c0c5ce;">()
</span></pre>
<p>And then let's toss the disposable into the bag.</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">private func </span><span style="color:#bf616a;">refreshData</span><span style="color:#c0c5ce;">() {
    </span><span style="color:#ebcb8b;">Service</span><span style="color:#c0c5ce;">.getSystemState().subscribe(</span><span style="color:#bf616a;">onSuccess</span><span style="color:#c0c5ce;">: { globalState </span><span style="color:#b48ead;">in
        </span><span style="color:#65737e;">// Something
</span><span style="color:#c0c5ce;">    }).disposed(</span><span style="color:#bf616a;">by</span><span style="color:#c0c5ce;">: </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.disposeBag)
}
</span></pre>
<p>Let's pause for a moment, and let's talk about coding styles üë©‚Äçüé® If you have been looking at the <a href="https://github.com/ReactiveX/RxSwift">RxSwift</a> documentation you might have noticed a particular style, everything is in a new line. That's to make things easier to read, it doesn't look like much right now, but believe me, the moment we start piling operators it will become evident.</p>
<p>Let's rewrite</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">private func </span><span style="color:#bf616a;">refreshData</span><span style="color:#c0c5ce;">() {
    </span><span style="color:#ebcb8b;">Service</span><span style="color:#c0c5ce;">.getSystemState()
        .</span><span style="color:#d08770;">subscribe</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">onSuccess</span><span style="color:#c0c5ce;">: { globalState </span><span style="color:#b48ead;">in
            </span><span style="color:#65737e;">// Something
</span><span style="color:#c0c5ce;">        })
        .</span><span style="color:#d08770;">disposed</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">by</span><span style="color:#c0c5ce;">: </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.disposeBag)
}
</span></pre>
<p>Let's do something with the response, basically what we were doing before:</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">private func </span><span style="color:#bf616a;">refreshData</span><span style="color:#c0c5ce;">() {
    </span><span style="color:#ebcb8b;">Service</span><span style="color:#c0c5ce;">.getSystemState()
        .</span><span style="color:#d08770;">subscribe</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">onSuccess</span><span style="color:#c0c5ce;">: { globalState </span><span style="color:#b48ead;">in
            self</span><span style="color:#c0c5ce;">.globalState = globalState
            </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.refreshData()
        })
        .</span><span style="color:#d08770;">disposed</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">by</span><span style="color:#c0c5ce;">: </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.disposeBag)
}
</span></pre>
<p>By the way, I'm not using <code>[weak self]</code> as in SwiftUI views are structs, but that transitions ourselves into the question &quot;<em>if views are value types and they are recreated when the state changes, what happens to the dispose bag and everything on them?</em>&quot;
That part is a little tricky. Let's leave that for later when we have some more endpoints to play with, so the example is more straight forward and easy to follow.<br />
Now you can rerun the app and see that everything still works. üéâ</p>
<p>I think it is time to wrap up this post.</p>
<h1 id="conclusions">Conclusions</h1>
<p>At this point, if you think this was easy and useful, maybe you weren't paying too much attention. We gained nothing so far, we introduced a massive dependency, the code is way more verbose, our build times went out of the window, and we have nothing better than the closure we have at the beginning, which at last was very straight forward. Also, we are still doing polling in the most horrible way possible.<br />
Don't get me wrong, it is not that wrapping simple endpoints using <a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/Traits.md#single">Single</a> is wrong, is just that so far I have shown you nothing new that can be done with <a href="https://github.com/ReactiveX/RxSwift">RxSwift</a> to make it a worthy addition into the codebase.</p>
<p>If you stay with me, I can show you some cool tricks and make all this worth it. For now, this was just an entre√©, a warm-up. Let's spice things a little on the next post by introducing some errors and uncertainties and see how we can handle them with <a href="https://github.com/ReactiveX/RxSwift">RxSwift</a></p>
<h4 id="unit-tests">Unit tests</h4>
<p>Regarding unit tests, there is not much to test so far, whatever test we could have for the original app are still valid as we haven't changed the behavior not introduced any new one.</p>
<h3 id="bonus-track">Bonus track</h3>
<p>I'll give you a little bonus track for this first post when I built <a href="/post-000.md#a-different-sample-app">FakeService framework</a> I used the concept of dependency injection described on <a href="https://www.pointfree.co">pointfree.co</a>, in particular starting on <a href="https://www.pointfree.co/episodes/ep16-dependency-injection-made-easy">this episode</a>: &quot;<em>Dependency Injection Made Easy</em>&quot;.</p>
<p>FakeService has a static struct with the name of <a href="https://github.com/Julioacarrettoni/playing-with-rxswift/blob/master/001/Before/FakeService/FakeServices.swift#L3-L11">Environment</a> that exposes control to certain aspects of the framework, the ones that are more fun are:</p>
<ul>
<li><code>delay</code>: Controls the delay for each request.</li>
<li><code>tick</code>: Is the internal clock and returns the numbers of seconds since the start of the app.</li>
</ul>
<p>With this we can make the app a little more interesting and useful, for example, we can override <code>tick</code> so instead of returning the number of seconds since the app launches it does something like this:</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> referenceDate = </span><span style="color:#ebcb8b;">Date</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">timeIntervalSinceNow</span><span style="color:#c0c5ce;">: -</span><span style="color:#d08770;">600</span><span style="color:#c0c5ce;">)
</span><span style="color:#ebcb8b;">FakeService</span><span style="color:#c0c5ce;">.</span><span style="color:#ebcb8b;">Current</span><span style="color:#c0c5ce;">.tick = { -referenceDate.timeIntervalSinceNow}
</span></pre>
<p>This way, the recording starts playing 10 minutes into it, which is 1 minute before &quot;James&quot; completes a delivery. This is useful to retry the same scenario over and over again.</p>
<p>Or we can get more crazy and do something like this:</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> ticksPerSecond = </span><span style="color:#d08770;">30
</span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> referenceDate = </span><span style="color:#ebcb8b;">Date</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">timeIntervalSinceNow</span><span style="color:#c0c5ce;">: </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#ebcb8b;">FakeService</span><span style="color:#c0c5ce;">.</span><span style="color:#ebcb8b;">Current</span><span style="color:#c0c5ce;">.tick = { -referenceDate.timeIntervalSinceNow * </span><span style="color:#ebcb8b;">Double</span><span style="color:#c0c5ce;">(ticksPerSecond)}
</span><span style="color:#ebcb8b;">FakeService</span><span style="color:#c0c5ce;">.</span><span style="color:#ebcb8b;">Current</span><span style="color:#c0c5ce;">.delay = { </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;"> }
</span></pre>
<p>Every real world second is 30 seconds worth of recording so things become a little more insteresting and less dull, which is nice to keep re-testing things without diying of boredom.</p>
<p>Anyway, have fun with it, now you can watch the whole hour's worth of content without having to waste a real hour üòâ.</p>
<h5 id="footnotes">Footnotes</h5>
<p><a id='1'>1</a>: <a href="https://www.theguardian.com/small-business-network/2017/feb/16/master-art-presenting-tell-story-brief-audience">Theguardian.com</a> The guardian: &quot;<em>Master the art of presenting: tell a story, keep it brief</em>&quot;<br />
<a id='2'>2</a>: <a href="https://www.lucidpress.com/blog/how-airbnb-and-apple-use-storytelling-marketing-to-build-their-brands">Lucidpress.com</a> &quot;<em>How Airbnb and Apple build their brands with storytelling marketing</em>&quot;<br />
<a id='3'>3</a>: <a href="https://enricoangelini.com/2011/ios-5-tech-talk-world-tour-in-rome/">Enricoangelini.com</a> look for &quot;<em>iPhone and iPad User Interface Design</em>&quot;<br />
<a id='4'>4</a>: Yes, that was a joke and that's one of the good ones, so brace yourself.<br />
<a id='5'>5</a>: If this story hits close to home, please accept my condolences.</p>

                            </div>
                        </div>
                        
                        
<footer class="card-footer">
    <div class="article-footer">
        <div class="columns is-multiline">
            <div class="column is-12">
                <p>
                    Published
                    

<time datetime="2020-03-15">
    2020-03-15
</time>


                    


                    


                    


                </p>
            </div>
            <div class="column">
                <a class="button is-pulled-right is-info" href="/playing-with-rxswift">Back Home</a>
            </div>
        </div>
    </div>
</footer>

                        
                    </div>
                </article>
            </div>
        </div>
    </section>
</main>

    
    

<footer class="footer js-only">
    <div class="columns">
        <div class="column">
            <div class="content is-flex">
                <div class="theme-select-container">
                    Theme:
                    <select id="theme-select">
                        
                        
                        
                        
                        
                        <option value="default">default</option>
                        
                        
                        
                        
                        
                        
                        <option selected="selected" value="darkly">darkly</option>
                        
                        
                        
                        
                        
                        
                        <option value="flatly">flatly</option>
                        
                        
                        
                        
                        
                        
                        <option value="pulse">pulse</option>
                        
                        
                        
                        
                        
                        
                        <option value="simplex">simplex</option>
                        
                        
                        
                        
                        
                        
                        <option value="lux">lux</option>
                        
                        
                        
                        
                        
                        
                        <option value="slate">slate</option>
                        
                        
                        
                        
                        
                        
                        <option value="solar">solar</option>
                        
                        
                        
                        
                        
                        
                        <option value="superhero">superhero</option>
                        
                        
                    </select>
                </div>
            </div>
        </div>
    </div>
</footer>


    

    <script type="text/javascript" src="https:&#x2F;&#x2F;julioacarrettoni.github.io&#x2F;playing-with-rxswift&#x2F;js&#x2F;zulma_navbar.js"></script>

    
    <script type="text/javascript" src="https:&#x2F;&#x2F;julioacarrettoni.github.io&#x2F;playing-with-rxswift&#x2F;js&#x2F;zulma_search.js"></script>
    

    
</body>

</html>
